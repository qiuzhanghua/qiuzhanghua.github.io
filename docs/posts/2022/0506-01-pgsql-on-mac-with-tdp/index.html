<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blog | 邱张华</title>
  <link rel="icon" type="image/png" href="/images/q-96.png">
  <link rel="stylesheet" href="/css/site.css">
  <link rel="stylesheet" href="/css/prism-okaidia.css">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Roboto&display=fallback" rel="stylesheet">
</head>
<body>
<header>
  <a href="/" class="link--home">博客</a>
  <a href="/about" class="link--about">邱张华</a>
</header>
<main>
  <article>
  <h1>pgsql on Mac with TDP</h1>
  <time datetime="2022-05-06T00:00:00.000Z">2022/05/06</time>
  <!-- Excerpt Start -->
<p>一切皆有可能</p>
<!-- Excerpt End -->
<h2>日常使用</h2>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># initdb -U postgres -W</span><br>pg_ctl -D <span class="token variable">$TDP_HOME</span>/data/pgsql/14.2-2 -l <span class="token variable">$TDP_HOME</span>/log/pgsql/14.2-2/logfile start<br><span class="token comment"># pg_ctl -D $TDP_HOME/data/pgsql/14.4-1 -l $TDP_HOME/log/pgsql/14.2-2/logfile start</span><br><span class="token comment"># createuser app -U postgres -P</span><br><span class="token comment"># createdb app -U postgres -O app -E UTF8 -e</span><br><span class="token comment"># psql -U app -d app -h 127.0.0.1</span><br>pg_ctl stop</code></pre>
<h2>安装</h2>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># ~/work/package-pgsql.sh -v 14.2-2 -o windows -w "邱张华"</span><br>~/work/package-pgsql.sh -v <span class="token number">14.2</span>-2 -o osx -w <span class="token string">"邱张华"</span></code></pre>
<h2>脚本</h2>
<pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span><br><span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">"v:o:w:"</span> arg<br><span class="token keyword">do</span> <span class="token keyword">case</span> <span class="token variable">$arg</span> <span class="token keyword">in</span><br><br>  <span class="token function">v</span><span class="token punctuation">)</span><br>    <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  w<span class="token punctuation">)</span><br>    <span class="token assign-left variable">writer</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  o<span class="token punctuation">)</span><br>    <span class="token assign-left variable">os</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  ?<span class="token punctuation">)</span><br>    <span class="token builtin class-name">echo</span> <span class="token string">"unknown argument"</span><br>    <span class="token builtin class-name">exit</span> <span class="token number">1</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  <span class="token keyword">esac</span><br><span class="token keyword">done</span><br><br><br><span class="token assign-left variable">os2</span><span class="token operator">=</span><span class="token variable">$os</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os</span>"</span> <span class="token operator">=</span> <span class="token string">"osx"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>	<span class="token assign-left variable">os2</span><span class="token operator">=</span><span class="token string">"darwin"</span><br><span class="token keyword">fi</span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os</span>"</span> <span class="token operator">=</span> <span class="token string">"win"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token assign-left variable">os2</span><span class="token operator">=</span><span class="token string">"windows"</span><br><span class="token keyword">fi</span><br><br><span class="token builtin class-name">cd</span> ~/work<br><span class="token function">mkdir</span> -p ~/work/origin/pgsql<br><span class="token builtin class-name">cd</span>  ~/work/origin/pgsql<br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os2</span>"</span> <span class="token operator">=</span> <span class="token string">"windows"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token assign-left variable">zipfile</span><span class="token operator">=</span><span class="token string">"postgresql-<span class="token variable">${version}</span>-windows-x64-binaries.zip"</span><br>	<span class="token assign-left variable">download_url</span><span class="token operator">=</span><span class="token string">"https://get.enterprisedb.com/postgresql/postgresql-<span class="token variable">${version}</span>-windows-x64-binaries.zip"</span><br><span class="token keyword">else</span><br>   <span class="token assign-left variable">zipfile</span><span class="token operator">=</span><span class="token string">"postgresql-<span class="token variable">${version}</span>-osx-binaries.zip"</span><br>   <span class="token assign-left variable">download_url</span><span class="token operator">=</span><span class="token string">"https://get.enterprisedb.com/postgresql/postgresql-<span class="token variable">${version}</span>-osx-binaries.zip"</span><br><span class="token keyword">fi</span><br><br><span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">"<span class="token variable">${zipfile}</span>"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> --no-check-certificate <span class="token variable">$download_url</span><br><br><span class="token function">rm</span> -rf ~/work/tmp<br><span class="token function">mkdir</span> -p ~/work/tmp<br><span class="token builtin class-name">cd</span> ~/work/tmp<br><br><span class="token function">unzip</span> -q ~/work/origin/pgsql/<span class="token variable">${zipfile}</span><br><br><br><span class="token function">mv</span> pgsql pgsql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span><br><span class="token builtin class-name">cd</span> pgsql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span><br><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os2</span>"</span> <span class="token operator">=</span> <span class="token string">"windows"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">then</span><br><span class="token builtin class-name">echo</span> <span class="token string">""</span>"name: pgsql<br>version: <span class="token variable">${version}</span><br>author: <span class="token variable">${writer}</span><br>once: <br>- <span class="token punctuation">\</span>"cmd /C <span class="token keyword">if</span> not exist %TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>data<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>pgsql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span> <span class="token function">mkdir</span> %TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>data<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>pgsql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>- <span class="token punctuation">\</span>"cmd /C <span class="token keyword">if</span> not exist %TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>log<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>pgsql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span> <span class="token function">mkdir</span> %TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>log<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>pgsql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>env:<br>   PGSQL_HOME: <span class="token punctuation">\</span>"%PLUGIN_HOME%<span class="token punctuation">\</span>"<br>   PGDATA: <span class="token punctuation">\</span>"<span class="token punctuation">\</span>%TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>data<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>pgsql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>   <span class="token environment constant">PATH</span><span class="token builtin class-name">:</span> <span class="token punctuation">\</span>"%PGSQL_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>bin<span class="token punctuation">;</span>%<span class="token environment constant">PATH</span>%<span class="token punctuation">\</span>"<br><span class="token string">""</span>" <span class="token operator">></span>tdp_plugin.yaml<br><br><span class="token keyword">else</span><br><span class="token builtin class-name">echo</span> <span class="token string">""</span>"name: pgsql<br>version: <span class="token variable">${version}</span><br>author: <span class="token variable">${writer}</span><br>once: <br>- <span class="token punctuation">\</span>"mkdir -p <span class="token punctuation">\</span><span class="token variable">${TDP_HOME}</span>/data/pgsql/<span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>- <span class="token punctuation">\</span>"mkdir -p <span class="token punctuation">\</span><span class="token variable">${TDP_HOME}</span>/log/pgsql/<span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>env:<br>   PGSQL_HOME: <span class="token punctuation">\</span><span class="token variable">${PLUGIN_HOME}</span><br>   PGDATA: <span class="token punctuation">\</span><span class="token variable">${TDP_HOME}</span>/data/pgsql/<span class="token variable">${version}</span><br>   <span class="token environment constant">PATH</span><span class="token builtin class-name">:</span> <span class="token punctuation">\</span><span class="token variable">${PGSQL_HOME}</span>/bin:<span class="token punctuation">\</span><span class="token variable">${<span class="token environment constant">PATH</span>}</span><br><span class="token string">""</span>" <span class="token operator">></span> tdp_plugin.yaml<br><span class="token keyword">fi</span><br><br><span class="token builtin class-name">cd</span> ~/work/tmp<br><br><span class="token function">zip</span> pgsql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>.zip -r -y pgsql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>/<br><br><span class="token function">mkdir</span> -p ~/work/plugin<br><br><span class="token function">cp</span> pgsql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>.zip ~/work/plugin<br></code></pre>

</article>
</main>
<footer>&copy; qiuzhanghua.github.io 2022</footer>
</body>
</html>