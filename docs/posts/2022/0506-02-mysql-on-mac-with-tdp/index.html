<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blog | 邱张华</title>
  <link rel="icon" type="image/png" href="/images/q-96.png">
  <link rel="stylesheet" href="/css/site.css">
  <link rel="stylesheet" href="/css/prism-okaidia.css">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Roboto&display=fallback" rel="stylesheet">
</head>
<body>
<header>
  <a href="/" class="link--home">博客</a>
  <a href="/about" class="link--about">邱张华</a>
</header>
<main>
  <article>
  <h1>MySQL on Mac with TDP</h1>
  <time datetime="2022-05-06T00:00:00.000Z">2022/05/06</time>
  <!-- Excerpt Start -->
<p>至诚至坚</p>
<!-- Excerpt End -->
<h2>启用/停止</h2>
<pre class="language-bash"><code class="language-bash">mysqld <span class="token operator">&amp;</span><br><br>mysqladmin -u root <span class="token function">shutdown</span></code></pre>
<h2>初始化SQL</h2>
<pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> app <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8mb4 <span class="token keyword">collate</span> utf8mb4_unicode_ci<span class="token punctuation">;</span><br><span class="token keyword">create</span> <span class="token keyword">user</span> app identified <span class="token keyword">by</span> <span class="token string">'app'</span><span class="token punctuation">;</span><br><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> app<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'app'</span><span class="token variable">@'%'</span> <span class="token keyword">with</span> <span class="token keyword">grant</span> <span class="token keyword">option</span><span class="token punctuation">;</span><br>flush <span class="token keyword">privileges</span><span class="token punctuation">;</span></code></pre>
<h2>安装</h2>
<pre class="language-bash"><code class="language-bash">~/work/package-mysql.sh -v <span class="token number">8.0</span>.29 -o macosx -a arm64 -w <span class="token string">"邱张华"</span></code></pre>
<h2>脚本</h2>
<pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span><br><br><span class="token comment"># ~/work/package-mysql.sh -v 8.0.29 -o macosx -a arm64 -w "邱张华"</span><br><br><span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">"v:o:a:w:z:"</span> arg<br><span class="token keyword">do</span> <span class="token keyword">case</span> <span class="token variable">$arg</span> <span class="token keyword">in</span><br><br>  <span class="token function">v</span><span class="token punctuation">)</span><br>    <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  w<span class="token punctuation">)</span><br>    <span class="token assign-left variable">writer</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  o<span class="token punctuation">)</span><br>    <span class="token assign-left variable">os</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  a<span class="token punctuation">)</span><br>    <span class="token assign-left variable">arch</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OPTARG</span>"</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span>   <br>  ?<span class="token punctuation">)</span><br>    <span class="token builtin class-name">echo</span> <span class="token string">"unknown argument"</span><br>    <span class="token builtin class-name">exit</span> <span class="token number">1</span><br>    <span class="token punctuation">;</span><span class="token punctuation">;</span><br>  <span class="token keyword">esac</span><br><span class="token keyword">done</span><br><br><br><span class="token assign-left variable">os2</span><span class="token operator">=</span><span class="token variable">$os</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os</span>"</span> <span class="token operator">=</span> <span class="token string">"macosx"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>	<span class="token assign-left variable">os2</span><span class="token operator">=</span><span class="token string">"darwin"</span><br><span class="token keyword">fi</span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os</span>"</span> <span class="token operator">=</span> <span class="token string">"win"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token assign-left variable">os2</span><span class="token operator">=</span><span class="token string">"windows"</span><br><span class="token keyword">fi</span><br><br><span class="token assign-left variable">arch2</span><span class="token operator">=</span><span class="token variable">$arch</span><br><span class="token assign-left variable">arch_url</span><span class="token operator">=</span><span class="token variable">$arch</span><br><span class="token builtin class-name">echo</span> <span class="token variable">$os</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os</span>"</span> <span class="token operator">!=</span> <span class="token string">"win"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"<span class="token variable">$arch</span>"</span> <span class="token operator">==</span> <span class="token string">"x64"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>	<span class="token assign-left variable">arch_url</span><span class="token operator">=</span><span class="token string">"x86_64"</span><br><span class="token keyword">fi</span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$arch</span>"</span> <span class="token operator">=</span> <span class="token string">"x64"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>	<span class="token assign-left variable">arch2</span><span class="token operator">=</span><span class="token string">"amd64"</span><br><span class="token keyword">fi</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$arch</span>"</span> <span class="token operator">=</span> <span class="token string">"aarch64"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token assign-left variable">arch2</span><span class="token operator">=</span><span class="token string">"arm64"</span><br><span class="token keyword">fi</span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$arch</span>"</span> <span class="token operator">=</span> <span class="token string">"i686"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token assign-left variable">arch2</span><span class="token operator">=</span><span class="token string">"386"</span><br><span class="token keyword">fi</span><br><br><span class="token assign-left variable">conf_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/conf<br><span class="token assign-left variable">major_version</span><span class="token operator">=</span><span class="token variable">${version<span class="token operator">:</span>0<span class="token operator">:</span>3}</span><br><br><span class="token builtin class-name">cd</span> ~/work<br><span class="token function">mkdir</span> -p ~/work/origin/mysql<br><span class="token builtin class-name">cd</span>  ~/work/origin/mysql<br><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os2</span>"</span> <span class="token operator">=</span> <span class="token string">"windows"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>	<span class="token assign-left variable">mysql_dir</span><span class="token operator">=</span>mysql-<span class="token variable">${version}</span>-win<span class="token variable">${arch_url}</span><br>	<span class="token assign-left variable">mysql_package</span><span class="token operator">=</span><span class="token string">"mysql-<span class="token variable">${version}</span>-win<span class="token variable">${arch_url}</span>.zip"</span><br>	<span class="token assign-left variable">download_url</span><span class="token operator">=</span><span class="token string">"https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-<span class="token variable">${major_version}</span>/mysql-<span class="token variable">${version}</span>-win<span class="token variable">${arch_url}</span>.zip"</span><br><span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os</span>"</span> <span class="token operator">=</span> <span class="token string">"macosx"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>	<span class="token assign-left variable">mysql_dir</span><span class="token operator">=</span>mysql-<span class="token variable">${version}</span>-macos12-<span class="token variable">${arch_url}</span><br>	<span class="token assign-left variable">mysql_package</span><span class="token operator">=</span><span class="token string">"mysql-<span class="token variable">${version}</span>-macos12-<span class="token variable">${arch_url}</span>.tar.gz"</span><br>	<span class="token assign-left variable">download_url</span><span class="token operator">=</span><span class="token string">"https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-<span class="token variable">${major_version}</span>/mysql-<span class="token variable">${version}</span>-macos12-<span class="token variable">${arch_url}</span>.tar.gz"</span><br><span class="token keyword">else</span><br>	<span class="token assign-left variable">mysql_dir</span><span class="token operator">=</span>mysql-<span class="token variable">${version}</span>-linux-glibc2.12-<span class="token variable">${arch_url}</span><br>	<span class="token assign-left variable">mysql_package</span><span class="token operator">=</span><span class="token string">"mysql-<span class="token variable">${version}</span>-linux-glibc2.12-<span class="token variable">${arch_url}</span>.tar"</span><br>	<span class="token assign-left variable">download_url</span><span class="token operator">=</span><span class="token string">"https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-<span class="token variable">${major_version}</span>/mysql-<span class="token variable">${version}</span>-linux-glibc2.12-<span class="token variable">${arch_url}</span>.tar"</span><br><span class="token keyword">fi</span><br><br><span class="token builtin class-name">echo</span> <span class="token variable">$download_url</span><br><span class="token builtin class-name">echo</span> <span class="token variable">$mysql_package</span><br><br><span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">"<span class="token variable">${mysql_package}</span>"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> --no-check-certificate <span class="token variable">$download_url</span><br><br><span class="token function">rm</span> -rf ~/work/tmp<br><span class="token function">mkdir</span> -p ~/work/tmp<br><span class="token builtin class-name">cd</span> ~/work/tmp<br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os2</span>"</span> <span class="token operator">=</span> <span class="token string">"windows"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token function">unzip</span> ~/work/origin/mysql/<span class="token variable">${mysql_package}</span><br><span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os2</span>"</span> <span class="token operator">=</span> <span class="token string">"darwin"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br>   <span class="token function">tar</span> -xvf ~/work/origin/mysql/<span class="token variable">${mysql_package}</span><br><span class="token keyword">else</span><br>   <span class="token function">tar</span> -xvf ~/work/origin/mysql/<span class="token variable">${mysql_package}</span><br>   xz -d ./mysql-<span class="token variable">${version}</span>-linux-glibc2.12-<span class="token variable">${arch_url}</span>.tar.xz<br>   <span class="token function">tar</span> -xvf ./mysql-<span class="token variable">${version}</span>-linux-glibc2.12-<span class="token variable">${arch_url}</span>.tar<br><span class="token keyword">fi</span><br><br><br><span class="token function">mv</span> <span class="token variable">${mysql_dir}</span>  mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span><br><span class="token builtin class-name">cd</span>  mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span><br><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$os2</span>"</span> <span class="token operator">=</span> <span class="token string">"windows"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">then</span><br><span class="token builtin class-name">echo</span> <span class="token string">""</span>"name: mysql<br>version: <span class="token variable">${version}</span><br>author: <span class="token variable">${writer}</span><br>once: <br>- <span class="token punctuation">\</span>"cmd /C <span class="token keyword">if</span> not exist %TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>data<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>mysql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span> <span class="token function">mkdir</span> %TDP_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>data<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>mysql<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>- <span class="token punctuation">\</span>"tiny-replace %MYSQL_HOME%/my.ini<span class="token punctuation">\</span>"<br>- <span class="token punctuation">\</span>"%MYSQL_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>bin<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>mysqld --initialize-insecure<span class="token punctuation">\</span>"<br>env:<br>   MYSQL_HOME: <span class="token punctuation">\</span>"%PLUGIN_HOME%<span class="token punctuation">\</span>"<br>   MYSQL_VERSION: <span class="token variable">${version}</span><br>   <span class="token environment constant">PATH</span><span class="token builtin class-name">:</span> <span class="token punctuation">\</span>"%MYSQL_HOME%<span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span><span class="token punctuation">\</span>bin<span class="token punctuation">;</span>%<span class="token environment constant">PATH</span>%<span class="token punctuation">\</span>"<br><span class="token string">""</span>" <span class="token operator">></span>tdp_plugin.yaml<br><br><span class="token function">cp</span> <span class="token variable">$conf_path</span>/mysql_windows/my.ini ./<br><br><span class="token keyword">else</span><br><span class="token builtin class-name">echo</span> <span class="token string">""</span>"name: mysql<br>version: <span class="token variable">${version}</span><br>author: <span class="token variable">${writer}</span><br>once: <br>- <span class="token punctuation">\</span>"mkdir -p <span class="token punctuation">\</span><span class="token variable">${TDP_HOME}</span>/data/mysql/<span class="token variable">${version}</span><span class="token punctuation">\</span>"<br>- <span class="token punctuation">\</span>"tiny-replace <span class="token punctuation">\</span><span class="token variable">${MYSQL_HOME}</span>/my.cnf<span class="token punctuation">\</span>"<br>- <span class="token punctuation">\</span>"<span class="token punctuation">\</span><span class="token variable">${MYSQL_HOME}</span>/bin/mysqld --initialize-insecure<span class="token punctuation">\</span>"<br>env:<br>   MYSQL_HOME: <span class="token punctuation">\</span><span class="token variable">${PLUGIN_HOME}</span><br>   MYSQL_VERSION: <span class="token variable">${version}</span><br>   CURRENT_USER: <span class="token punctuation">\</span><span class="token variable">${<span class="token environment constant">USER</span>}</span><br>   <span class="token environment constant">PATH</span><span class="token builtin class-name">:</span> <span class="token punctuation">\</span><span class="token variable">${MYSQL_HOME}</span>/bin:<span class="token punctuation">\</span><span class="token variable">${<span class="token environment constant">PATH</span>}</span><br><span class="token string">""</span>" <span class="token operator">></span> tdp_plugin.yaml<br><br><span class="token function">cp</span> <span class="token variable">$conf_path</span>/mysql_linux/my.cnf ./<br><span class="token keyword">fi</span><br><br><span class="token builtin class-name">cd</span> ~/work/tmp<br><br><span class="token function">zip</span> -q mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span>.zip -r -y mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span>/<br><br><span class="token function">mkdir</span> -p ~/work/plugin<br><br><span class="token keyword">if</span> <span class="token punctuation">[</span> -f ~/work/plugin/mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span>.zip <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span><br> <span class="token function">rm</span> -f ~/work/plugin/mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span>.zip<br><span class="token keyword">fi</span><br><br><span class="token function">cp</span> mysql_<span class="token variable">${version}</span>_<span class="token variable">${os2}</span>_<span class="token variable">${arch2}</span>.zip ~/work/plugin</code></pre>

</article>
</main>
<footer>&copy; qiuzhanghua.github.io 2022</footer>
</body>
</html>